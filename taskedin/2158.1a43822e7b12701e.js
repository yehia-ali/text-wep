"use strict";(self.webpackChunktaskedin=self.webpackChunktaskedin||[]).push([[2158],{82158:(ee,u,r)=>{r.r(u),r.d(u,{AllUsersComponent:()=>W});var c=r(96814),x=r(38140),e=r(65879),A=r(85195),C=r(86760),U=r(55237),T=r(824),_=r(32296),d=r(75986),Z=r(24971),b=r(10480),m=r(89515),h=r(17700),f=r(53451),F=r(15714);function k(l,o){if(1&l){const t=e.EpF();e.TgZ(0,"departments",14),e.NdJ("valueChanged",function(s){e.CHM(t);const i=e.oxw();return i.service.department.next(s),e.KtG(i.filter())}),e.qZA()}if(2&l){const t=e.oxw();e.Q6J("selectedDepartment",t.service.department.value)}}function J(l,o){if(1&l){const t=e.EpF();e.TgZ(0,"assignee-state",15),e.NdJ("valueChanged",function(s){e.CHM(t);const i=e.oxw();return i.service.assigneeState.next(s),e.KtG(i.filter())}),e.qZA()}if(2&l){const t=e.oxw();e.Q6J("selectedValue",t.service.assigneeState.value)}}function N(l,o){if(1&l){const t=e.EpF();e.TgZ(0,"date-filter",16),e.NdJ("valueChanged",function(s){e.CHM(t);const i=e.oxw();return i.service.dateFrom.next(s),i.service.dateTo.next(""),e.KtG(i.filter())}),e.qZA()}if(2&l){const t=e.oxw();e.Q6J("selectedValue",t.service.dateFrom.value)}}function y(l,o){if(1&l){const t=e.EpF();e.TgZ(0,"date-filter",17),e.NdJ("valueChanged",function(s){e.CHM(t);const i=e.oxw();return i.service.dateTo.next(s),e.KtG(i.filter())}),e.qZA()}if(2&l){const t=e.oxw();e.Q6J("minDate",t.service.dateFrom.value)("selectedValue",t.service.dateTo.value)}}function q(l,o){if(1&l){const t=e.EpF();e.TgZ(0,"select-user",18),e.NdJ("getSelectedUsers",function(s){e.CHM(t);const i=e.oxw();return i.service.managers.next(s),e.KtG(i.filter())}),e.qZA()}if(2&l){const t=e.oxw();e.Q6J("selectedUsers",t.service.managers.value)}}function O(l,o){if(1&l){const t=e.EpF();e.TgZ(0,"div",21)(1,"mat-checkbox",22),e.NdJ("change",function(){const i=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.unCheck(i))}),e._uU(2),e.ALo(3,"translate"),e.qZA()()}if(2&l){const t=o.$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("checked",n.visibleFilters[t])("indeterminate",!1)("labelPosition","after"),e.xp6(1),e.hij(" ",e.lcZ(3,4,t)," ")}}function I(l,o){if(1&l&&(e.TgZ(0,"div",19),e.NdJ("click",function(n){return n.stopImmediatePropagation()}),e.YNc(1,O,4,6,"div",20),e.qZA()),2&l){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.filtersArray)}}const S=function(l){return{"bg-primary white":l}};let Q=(()=>{class l{constructor(){this.export=new e.vpe,this.service=(0,e.f3M)(f.L),this.dialog=(0,e.f3M)(h.uw),this.showFilters=!1,this.visibleFilters={departments:!0,assignee_state:!0,managers:this.service.assignees.value.length>0,date:this.service.dateFrom.value||this.service.dateTo.value},this.filtersArray=Object.keys(this.visibleFilters).map(t=>t)}filter(){this.service.filter()}setRoles(){this.dialog.open(F.z,{panelClass:"add-roles-dialog",data:{users:this.service.selectedUsersToAddRoleValue}})}unCheck(t){this.visibleFilters[t]=!this.visibleFilters[t]}documentClickEvent(t){this.showFilters=!1}static{this.\u0275fac=function(n){return new(n||l)}}static{this.\u0275cmp=e.Xpm({type:l,selectors:[["all-users-filter"]],hostBindings:function(n,s){1&n&&e.NdJ("click",function(a){return s.documentClickEvent(a)},!1,e.evT)},outputs:{export:"export"},standalone:!0,features:[e.jDz],decls:18,vars:18,consts:[[1,"filters","flex","aic","jcsb","gap-x-4"],[1,"flex-wrap","aic","gap-x-1","gap-y-1"],[3,"key","valueChanged"],[3,"selectedDepartment","valueChanged",4,"ngIf"],[3,"selectedValue","valueChanged",4,"ngIf"],["key","start_date",3,"selectedValue","valueChanged",4,"ngIf"],["key","end_date",3,"minDate","selectedValue","valueChanged",4,"ngIf"],["class","no-label","text","managers",3,"selectedUsers","getSelectedUsers",4,"ngIf"],[1,"end","flex","aic","gap-x-2","pt-75"],["mat-raised-button","",3,"ngClass","disabled","click"],["mat-raised-button","",1,"bg-success","export",3,"click"],[1,"img","relative","pointer",3,"click"],["alt","","src","assets/images/icons/filters.svg",1,"convert-image-color"],["class","filters-menu bg-white p-1 rounded","magicScroll","",3,"click",4,"ngIf"],[3,"selectedDepartment","valueChanged"],[3,"selectedValue","valueChanged"],["key","start_date",3,"selectedValue","valueChanged"],["key","end_date",3,"minDate","selectedValue","valueChanged"],["text","managers",1,"no-label",3,"selectedUsers","getSelectedUsers"],["magicScroll","",1,"filters-menu","bg-white","p-1","rounded",3,"click"],["class","menu-item",4,"ngFor","ngForOf"],[1,"menu-item"],["color","primary",3,"checked","indeterminate","labelPosition","change"]],template:function(n,s){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"search",2),e.NdJ("valueChanged",function(a){return s.service.search.next(a),s.filter()}),e.qZA(),e.YNc(3,k,1,1,"departments",3),e.YNc(4,J,1,1,"assignee-state",4),e.YNc(5,N,1,1,"date-filter",5),e.YNc(6,y,1,2,"date-filter",6),e.YNc(7,q,1,1,"select-user",7),e.qZA(),e.TgZ(8,"div",8)(9,"button",9),e.NdJ("click",function(){return s.setRoles()}),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"button",10),e.NdJ("click",function(){return s.export.emit()}),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"div",11),e.NdJ("click",function(a){return a.stopImmediatePropagation(),s.showFilters=!0}),e._UZ(16,"img",12),e.YNc(17,I,2,1,"div",13),e.qZA()()()),2&n&&(e.xp6(2),e.Q6J("key",s.service.search.value),e.xp6(1),e.Q6J("ngIf",s.visibleFilters.departments),e.xp6(1),e.Q6J("ngIf",s.visibleFilters.assignee_state),e.xp6(1),e.Q6J("ngIf",s.visibleFilters.date),e.xp6(1),e.Q6J("ngIf",s.visibleFilters.date),e.xp6(1),e.Q6J("ngIf",s.visibleFilters.managers),e.xp6(2),e.Q6J("ngClass",e.VKq(16,S,s.service.selectedUsersToAddRoleValue.length>0))("disabled",0==s.service.selectedUsersToAddRoleValue.length),e.xp6(1),e.AsE(" ",e.lcZ(11,12,"set_roles")," (",s.service.selectedUsersToAddRoleValue.length,") "),e.xp6(3),e.Oqu(e.lcZ(14,14,"export")),e.xp6(4),e.Q6J("ngIf",s.showFilters))},dependencies:[c.ez,c.mk,c.sg,c.O5,A.r,C.g,U.S,T.h,_.ot,_.lW,d.p9,d.oG,Z.g,b.V,m.aw,m.X$]})}}return l})();var v=r(76472),w=r(45843),R=r(9619),Y=r(57105),E=r(65668),g=r(11486),M=r(83318),P=r(9983),L=r(17476),V=r(99758);function H(l,o){if(1&l){const t=e.EpF();e.TgZ(0,"i",28),e.NdJ("click",function(){e.CHM(t);const s=e.oxw().$implicit,i=e.oxw(2).$implicit,a=e.oxw(2);return e.KtG(a.removeRole(i,s.roleName))}),e.qZA()}}function $(l,o){if(1&l&&(e.TgZ(0,"div",26)(1,"p"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,H,1,0,"i",27),e.qZA()),2&l){const t=o.$implicit;e.xp6(2),e.Oqu(e.lcZ(3,2,t.roleName)),e.xp6(2),e.Q6J("ngIf","SpaceSuperAdmin"!=t.roleName&&"SpaceManager"!==t.roleName&&"KPIRater"!=t.roleName)}}function G(l,o){if(1&l&&(e.TgZ(0,"div",24),e.YNc(1,$,5,4,"div",25),e.qZA()),2&l){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",t.profileRoles)}}function K(l,o){1&l&&(e.TgZ(0,"p",12),e._uU(1,"-"),e.qZA())}function D(l,o){if(1&l){const t=e.EpF();e.TgZ(0,"tr",14)(1,"td")(2,"div",8)(3,"mat-checkbox",9),e.NdJ("change",function(s){const a=e.CHM(t).$implicit,p=e.oxw(2);return e.KtG(p.selectUser(s,a))}),e.qZA(),e._UZ(4,"user-image",15),e.TgZ(5,"div",16)(6,"p",17),e._uU(7),e.qZA(),e.TgZ(8,"p",18),e._uU(9),e.qZA()()()(),e.TgZ(10,"td",11),e._uU(11),e.qZA(),e.TgZ(12,"td",11),e._uU(13),e.qZA(),e.TgZ(14,"td",11),e._uU(15),e.qZA(),e.TgZ(16,"th",19),e._uU(17),e.ALo(18,"arabicDate"),e.qZA(),e.TgZ(19,"td",11),e._uU(20),e.qZA(),e.TgZ(21,"td",12),e.YNc(22,G,2,1,"div",20),e.YNc(23,K,2,0,"p",21),e.qZA(),e.TgZ(24,"td")(25,"div",22),e.NdJ("click",function(){const i=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.editUser(i))}),e._UZ(26,"img",23),e.qZA()()()}if(2&l){const t=o.$implicit;e.xp6(3),e.Q6J("checked",t.isSelected),e.xp6(1),e.Q6J("img",t.imageUrl)("id",t.isActivated?t.id:0),e.xp6(3),e.Oqu(t.name),e.xp6(2),e.Oqu(t.jobTitle),e.xp6(2),e.Oqu(t.phoneNumber),e.xp6(2),e.Oqu(t.departmentName),e.xp6(2),e.Oqu(t.managerName),e.xp6(2),e.Oqu(e.xi3(18,12,t.creationDate,"typicalDate")),e.xp6(3),e.Oqu(t.memberCode),e.xp6(2),e.Q6J("ngIf",t.profileRoles.length>0),e.xp6(1),e.Q6J("ngIf",t.profileRoles.length<1)}}const B=function(l,o,t){return{itemsPerPage:l,currentPage:o,totalItems:t}};function j(l,o){if(1&l){const t=e.EpF();e.TgZ(0,"table",6)(1,"thead",7)(2,"tr")(3,"th")(4,"div",8)(5,"mat-checkbox",9),e.NdJ("change",function(s){e.CHM(t);const i=e.oxw();return e.KtG(i.selectAllUsers(s))}),e.qZA(),e.TgZ(6,"div",10),e._uU(7),e.ALo(8,"translate"),e.qZA()()(),e.TgZ(9,"th",11),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"th",11),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"th",11),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.TgZ(18,"th"),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"th",11),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"th",12),e._uU(25),e.ALo(26,"translate"),e.qZA(),e._UZ(27,"th"),e.qZA()(),e.TgZ(28,"tbody"),e.YNc(29,D,27,15,"tr",13),e.ALo(30,"paginate"),e.qZA()()}if(2&l){const t=e.oxw();e.xp6(5),e.Q6J("checked",t.allChecked),e.xp6(2),e.Oqu(e.lcZ(8,10,"user")),e.xp6(3),e.Oqu(e.lcZ(11,12,"phone")),e.xp6(3),e.Oqu(e.lcZ(14,14,"department")),e.xp6(3),e.Oqu(e.lcZ(17,16,"manager")),e.xp6(3),e.Oqu(e.lcZ(20,18,"joining_date")),e.xp6(3),e.Oqu(e.lcZ(23,20,"code")),e.xp6(3),e.Oqu(e.lcZ(26,22,"role")),e.xp6(4),e.Q6J("ngForOf",e.xi3(30,24,t.users,e.kEZ(27,B,t.meta.pageSize,t.meta.currentPage,t.meta.totalItems)))("ngForTrackBy",t.trackBy)}}function z(l,o){1&l&&e._UZ(0,"not-found")}function X(l,o){1&l&&e._UZ(0,"loading")}let W=(()=>{class l{constructor(t,n,s,i,a){this.service=t,this.dialog=n,this.rolesSer=s,this.elm=i,this.alert=a,this.users=[],this.loading=!1,this.allChecked=!1,this.selectedUsers=[],this.selectedUsersToAddRole=[]}ngOnInit(){this.service.selectedUsersToAddRole.subscribe(t=>this.selectedUsersToAddRole=t),this.rolesSer.isAdmin.subscribe(t=>this.spaceAdmin=t),this.service.meta.subscribe(t=>this.meta=t),this.service.users$.subscribe(t=>{this.users=t,this.checkAllCheckedUsers()}),this.service.loading.subscribe(t=>this.loading=t),0==this.users.length&&this.service.search.next("")}getUsers(){this.service.hasChanged.next(!0)}selectAllUsers(t){this.allChecked=!0,this.users.forEach(n=>{this.selectUser(t,n)})}selectUser(t,n){t.checked?(n.isSelected=!0,this.getSelectedUsers()):(this.allChecked=!1,this.removeSelectedUser(n),n.isSelected=!1),this.checkAllCheckedUsers()}getSelectedUsers(){this.selectedUsers=this.users.filter(n=>n.isSelected),this.selectedUsers=this.selectedUsers.filter(n=>!this.selectedUsersToAddRole.find(s=>n.id==s.id)),this.service.selectedUsersToAddRole.next([].concat(this.selectedUsersToAddRole,this.selectedUsers))}removeSelectedUser(t){let n=this.selectedUsersToAddRole.filter(s=>t.id!=s.id);this.service.selectedUsersToAddRole.next(n)}checkAllCheckedUsers(){let t=0;this.users.forEach(n=>{n.isSelected&&t++}),this.allChecked=t==this.users.length}editUser(t){let n=!1;t.profileRoles.forEach(s=>{"SpaceSuperAdmin"==s.roleName&&(n=!0)}),this.dialog.open(P.a,{panelClass:"w-90v",data:{user:t,isSuperAdmin:n}})}removeRole(t,n){this.dialog.open(M.v,{panelClass:"confirmation-dialog",data:{message:"delete_role",btn_name:"confirm",classes:"w-100 bg-primary white",user:t,roleName:n}}).afterClosed().subscribe(i=>{i&&this.service.addOrRemoveRole({profileIds:[t.id],roleNames:[n],isAddedRole:!1}).subscribe(p=>{p.success&&(this.alert.showAlert("role_removed"),this.service.hasChanged.next(!0))})})}pageChanged(t){this.service.page.next(t),this.getUsers()}limitChanged(t){this.service.page.next(1),this.service.limit.next(t),this.getUsers()}exportToExcel(){let t=this.elm.nativeElement.querySelector("#users");const n=g.P6.table_to_sheet(t),s=g.P6.book_new();g.P6.book_append_sheet(s,n,"Sheet1"),g.NC(s,"users.xlsx")}trackBy(t,n){return n.id}static{this.\u0275fac=function(n){return new(n||l)(e.Y36(f.L),e.Y36(h.uw),e.Y36(L.f),e.Y36(e.SBq),e.Y36(V.c))}}static{this.\u0275cmp=e.Xpm({type:l,selectors:[["all-users"]],standalone:!0,features:[e.jDz],decls:7,vars:6,consts:[[3,"meta","admin","limit","pageChange","limitChanged"],["filters",""],[3,"export"],["content",""],["class","table","id","users",4,"ngIf"],[4,"ngIf"],["id","users",1,"table"],[1,"bg-gray","border-bottom"],[1,"flex","aic"],["color","primary",1,"mr-1","example-margin",3,"checked","change"],[1,"title"],[1,"text-left"],[1,"text-center"],["class","border-bottom",4,"ngFor","ngForOf","ngForTrackBy"],[1,"border-bottom"],[3,"img","id"],[1,"ml-1","text-left"],[1,"primary","bold","fs-14"],[1,"job-title","fs-11","muted"],[2,"width","13rem"],["class","flex-column gap-y-1",4,"ngIf"],["class","text-center",4,"ngIf"],[1,"img","pointer",3,"click"],["src","assets/images/icons/edit1.svg","alt","edit icon"],[1,"flex-column","gap-y-1"],["class","flex-center gap-x-1",4,"ngFor","ngForOf"],[1,"flex-center","gap-x-1"],["class","bx bx-x danger fs-22 pointer",3,"click",4,"ngIf"],[1,"bx","bx-x","danger","fs-22","pointer",3,"click"]],template:function(n,s){1&n&&(e.TgZ(0,"layout-with-filters",0),e.NdJ("pageChange",function(a){return s.pageChanged(a)})("limitChanged",function(a){return s.limitChanged(a)}),e.ynx(1,1),e.TgZ(2,"all-users-filter",2),e.NdJ("export",function(){return s.exportToExcel()}),e.qZA(),e.BQk(),e.ynx(3,3),e.YNc(4,j,31,31,"table",4),e.YNc(5,z,1,0,"not-found",5),e.YNc(6,X,1,0,"loading",5),e.BQk(),e.qZA()),2&n&&(e.Q6J("meta",s.meta)("admin",!0)("limit",s.service.limit.value),e.xp6(4),e.Q6J("ngIf",s.users&&s.users.length>0&&!s.loading),e.xp6(1),e.Q6J("ngIf",s.users&&0==s.users.length&&!s.loading),e.xp6(1),e.Q6J("ngIf",s.loading))},dependencies:[c.ez,c.sg,c.O5,x.Y,Q,d.p9,d.oG,m.aw,m.X$,v.JX,v._s,w.l,R.P,Y.w,E.N],styles:[".table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:1.3rem!important}"]})}}return l})()}}]);