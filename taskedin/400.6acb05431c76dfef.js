"use strict";(self.webpackChunktaskedin=self.webpackChunktaskedin||[]).push([[400],{28591:(J,D,n)=>{n.d(D,{T:()=>G});var t=n(96814),m=n(52081),e=n(65879);function C(i,d){1&i&&e._UZ(0,"i",13)}function l(i,d){1&i&&e._UZ(0,"i",14)}function O(i,d){1&i&&e._UZ(0,"i",15)}function T(i,d){1&i&&e._UZ(0,"i",13)}function g(i,d){1&i&&e._UZ(0,"i",14)}function f(i,d){1&i&&e._UZ(0,"i",15)}function v(i,d){1&i&&e._UZ(0,"i",13)}function _(i,d){1&i&&e._UZ(0,"i",14)}function Z(i,d){1&i&&e._UZ(0,"i",15)}function R(i,d){1&i&&e._UZ(0,"i",13)}function L(i,d){1&i&&e._UZ(0,"i",14)}function I(i,d){1&i&&e._UZ(0,"i",15)}function Q(i,d){1&i&&e._UZ(0,"i",13)}function o(i,d){1&i&&e._UZ(0,"i",14)}function s(i,d){1&i&&e._UZ(0,"i",15)}function P(i,d){if(1&i&&(e.TgZ(0,"div",4)(1,"div",5),e.YNc(2,C,1,0,"i",6),e.YNc(3,l,1,0,"i",7),e.YNc(4,O,1,0,"i",8),e.qZA(),e.TgZ(5,"div",9),e.YNc(6,T,1,0,"i",6),e.YNc(7,g,1,0,"i",7),e.YNc(8,f,1,0,"i",8),e.qZA(),e.TgZ(9,"div",10),e.YNc(10,v,1,0,"i",6),e.YNc(11,_,1,0,"i",7),e.YNc(12,Z,1,0,"i",8),e.qZA(),e.TgZ(13,"div",11),e.YNc(14,R,1,0,"i",6),e.YNc(15,L,1,0,"i",7),e.YNc(16,I,1,0,"i",8),e.qZA(),e.TgZ(17,"div",12),e.YNc(18,Q,1,0,"i",6),e.YNc(19,o,1,0,"i",7),e.YNc(20,s,1,0,"i",8),e.qZA()()),2&i){const p=e.oxw();e.xp6(2),e.Q6J("ngIf",p.rate<.5),e.xp6(1),e.Q6J("ngIf",p.rate>=.5&&p.rate<1),e.xp6(1),e.Q6J("ngIf",p.rate>=1),e.xp6(2),e.Q6J("ngIf",p.rate<1.5),e.xp6(1),e.Q6J("ngIf",p.rate>=1.5&&p.rate<2),e.xp6(1),e.Q6J("ngIf",p.rate>=2),e.xp6(2),e.Q6J("ngIf",p.rate<2.5),e.xp6(1),e.Q6J("ngIf",p.rate>=2.5&&p.rate<3),e.xp6(1),e.Q6J("ngIf",p.rate>=3),e.xp6(2),e.Q6J("ngIf",p.rate<3.5),e.xp6(1),e.Q6J("ngIf",p.rate>=3.5&&p.rate<4),e.xp6(1),e.Q6J("ngIf",p.rate>=4),e.xp6(2),e.Q6J("ngIf",p.rate<4.5),e.xp6(1),e.Q6J("ngIf",p.rate>=4.5&&p.rate<5),e.xp6(1),e.Q6J("ngIf",p.rate>=5)}}const k=function(i){return{warning:i}};function A(i,d){if(1&i&&e._UZ(0,"i",16),2&i){const p=e.oxw();e.Q6J("ngClass",e.VKq(1,k,p.rate))}}function N(i,d){if(1&i&&(e.TgZ(0,"p",17),e._uU(1),e.ALo(2,"number"),e.qZA()),2&i){const p=e.oxw();e.xp6(1),e.Oqu(e.xi3(2,1,p.rate,"1.1-1"))}}function M(i,d){1&i&&(e.TgZ(0,"p",17),e._uU(1),e.ALo(2,"arabicNumbers"),e.ALo(3,"arabicNumbers"),e.qZA()),2&i&&(e.xp6(1),e.AsE("",e.lcZ(2,2,0),".",e.lcZ(3,4,0),""))}const b=function(i){return{"gap-x-1":i}};let G=(()=>{class i{constructor(){this.rate=1,this.size="",this.type="large",this.displayNumber=!0}static{this.\u0275fac=function(U){return new(U||i)}}static{this.\u0275cmp=e.Xpm({type:i,selectors:[["rate"]],inputs:{rate:"rate",size:"size",type:"type",displayNumber:"displayNumber"},standalone:!0,features:[e.jDz],decls:5,vars:10,consts:[[3,"ngClass"],["class","rate flex aic",4,"ngIf"],["class","bx bxs-star mr-50",3,"ngClass",4,"ngIf"],["class","fs-15",4,"ngIf"],[1,"rate","flex","aic"],[1,"rate-1","img"],["class","bx bx-star",4,"ngIf"],["class","bx bxs-star-half warning",4,"ngIf"],["class","bx bxs-star warning",4,"ngIf"],[1,"rate-2","img"],[1,"rate-3","img"],[1,"rate-4","img"],[1,"rate-5","img"],[1,"bx","bx-star"],[1,"bx","bxs-star-half","warning"],[1,"bx","bxs-star","warning"],[1,"bx","bxs-star","mr-50",3,"ngClass"],[1,"fs-15"]],template:function(U,h){1&U&&(e.TgZ(0,"div",0),e.YNc(1,P,21,15,"div",1),e.YNc(2,A,1,3,"i",2),e.YNc(3,N,3,4,"p",3),e.YNc(4,M,4,6,"p",3),e.qZA()),2&U&&(e.Gre("flex aic ",h.size,""),e.Q6J("ngClass",e.VKq(8,b,"large"==h.type)),e.xp6(1),e.Q6J("ngIf","large"==h.type),e.xp6(1),e.Q6J("ngIf","small"==h.type),e.xp6(1),e.Q6J("ngIf",(h.displayNumber||"small"==h.type)&&h.rate),e.xp6(1),e.Q6J("ngIf",(h.displayNumber||"small"==h.type)&&!h.rate))},dependencies:[t.ez,t.mk,t.O5,t.JJ,m.m],encapsulation:2})}}return i})()},20400:(J,D,n)=>{n.d(D,{t:()=>K});var t=n(65879),m=n(96814),e=n(56223),C=n(41614),l=n(74104),O=n(65668),T=n(57105),g=n(45843),f=n(68577),v=n(82424),_=n(28591),Z=n(94279),R=n(9798),L=n(89515),I=n(64190),Q=n(69862),o=n(65648);const s=["assigneeslist"];function P(r,x){if(1&r&&t._UZ(0,"time-left",17),2&r){const a=t.oxw(2).$implicit;t.Q6J("label",a.timeLeftLabel)("timeLeft",a.timeLeft)("bullet",a.bullet)("showLeft",!0)}}function k(r,x){if(1&r&&(t.TgZ(0,"div",18),t._UZ(1,"task-overdue",19),t.TgZ(2,"span",20),t._uU(3),t.ALo(4,"translate"),t.qZA()()),2&r){const a=t.oxw(2).$implicit;t.xp6(1),t.Q6J("endedTaskRepeatedCounter",a.endedTaskRepeatedCounter),t.xp6(2),t.Oqu(t.lcZ(4,2,"overdue"))}}function A(r,x){if(1&r&&t._UZ(0,"rate",21),2&r){const a=t.oxw(2).$implicit;t.Q6J("rate",a.rate)}}function N(r,x){if(1&r&&t._UZ(0,"task-vote-progress",22),2&r){const a=t.oxw(2).$implicit;t.Q6J("progress",a.percentage)}}function M(r,x){if(1&r&&(t.TgZ(0,"div",12),t.YNc(1,P,1,4,"time-left",13),t.YNc(2,k,5,4,"div",14),t.YNc(3,A,1,1,"rate",15),t.YNc(4,N,1,1,"task-vote-progress",16),t.qZA()),2&r){const a=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf",!a.isOverDue&&(1==a.taskStateId||3==a.taskStateId)),t.xp6(1),t.Q6J("ngIf",a.isOverDue),t.xp6(1),t.Q6J("ngIf",2==a.taskStateId),t.xp6(1),t.Q6J("ngIf",3==a.taskStateId)}}function b(r,x){if(1&r){const a=t.EpF();t.TgZ(0,"div",3),t.NdJ("click",function(){const E=t.CHM(a).$implicit,y=t.oxw();return t.KtG(y.isDetails&&y.changeId(E.id))}),t.TgZ(1,"div",4)(2,"user-image",5),t.NdJ("click",function(u){return u.stopImmediatePropagation()}),t.qZA(),t.TgZ(3,"div",6)(4,"p",7),t._uU(5),t.qZA(),t.TgZ(6,"p",8),t._uU(7),t.qZA()()(),t.YNc(8,M,5,4,"div",9),t.TgZ(9,"div",10),t._UZ(10,"task-status",11),t.qZA()()}if(2&r){const a=x.$implicit,c=t.oxw();t.Q6J("routerLink",c.isDetails?null:c.isProject?"/tasks/details/"+a.id:"details/"+a.id),t.xp6(2),t.Q6J("img",a.assigneeProfilePicture)("id",a.assigneeId),t.xp6(3),t.Oqu(a.assigneeName),t.xp6(2),t.Oqu(a.assigneeJob),t.xp6(1),t.Q6J("ngIf",6!=a.taskStateId&&8!=a.taskStateId&&7!=a.taskStateId),t.xp6(2),t.Q6J("state",a.taskStateId)}}let G=(()=>{class r{constructor(a,c,u){this.route=a,this.router=c,this.service=u,this.tasks=[],this.isDetails=!1,this.isProject=!1,this.close=new t.vpe,this.limit=20,this.page=1,this.users=[]}ngOnInit(){this.getAllAssinees()}ngAfterViewInit(){this.assigneesList.nativeElement.addEventListener("scroll",this.onScroll.bind(this))}onScroll(a){a.target.scrollTop+a.target.clientHeight+10>=a.target.scrollHeight&&this.moreUsersStatus&&(this.page+=1,this.getAllAssinees(),setTimeout(()=>{this.moreUsersStatus=!1},0))}getAllAssinees(){this.loading=!0;let a=(new Q.LE).set("id",this.taskGroupId).set("page",this.page).set("limit",this.limit);this.service.getAllAssignees(a).subscribe(c=>{this.loading=!1,c.items.forEach(u=>{this.users.push(u)}),this.totalItems=c.totalItems,this.moreUsersStatus=!(this.page>=this.totalItems/this.limit)})}changeId(a){const c=window.location.pathname,u=c.split("/"),y=c.replace(u[u.length-1],a);this.router.navigateByUrl(y)}static{this.\u0275fac=function(c){return new(c||r)(t.Y36(I.gz),t.Y36(I.F0),t.Y36(o.Q))}}static{this.\u0275cmp=t.Xpm({type:r,selectors:[["task-group-assignees"]],viewQuery:function(c,u){if(1&c&&t.Gf(s,5),2&c){let E;t.iGM(E=t.CRH())&&(u.assigneesList=E.first)}},inputs:{tasks:"tasks",isDetails:"isDetails",isProject:"isProject",taskGroupId:"taskGroupId"},outputs:{close:"close"},standalone:!0,features:[t.jDz],decls:3,vars:1,consts:[[1,"assignees-list","px-2","py-2"],["assigneeslist",""],["class","task-card relative rounded bg-gray p-1 pointer",3,"routerLink","click",4,"ngFor","ngForOf"],[1,"task-card","relative","rounded","bg-gray","p-1","pointer",3,"routerLink","click"],[1,"start","flex","aic"],[3,"img","id","click"],[1,"user-info","ml-1"],[1,"mb-25","fs-15"],[1,"muted","fs-14"],["class","end border-top mt-1 pt-1 flex aic jcsb",4,"ngIf"],[1,"status"],["classes","p-1",3,"state"],[1,"end","border-top","mt-1","pt-1","flex","aic","jcsb"],["classes","fs-14",3,"label","timeLeft","bullet","showLeft",4,"ngIf"],["class","overdue flex aic",4,"ngIf"],["type","small",3,"rate",4,"ngIf"],[3,"progress",4,"ngIf"],["classes","fs-14",3,"label","timeLeft","bullet","showLeft"],[1,"overdue","flex","aic"],["classes","fs-14",3,"endedTaskRepeatedCounter"],[1,"ml-50","danger","fs-14"],["type","small",3,"rate"],[3,"progress"]],template:function(c,u){1&c&&(t.TgZ(0,"div",0,1),t.YNc(2,b,11,7,"div",2),t.qZA()),2&c&&(t.xp6(2),t.Q6J("ngForOf",u.users))},dependencies:[m.ez,m.sg,m.O5,g.l,f.p,v.n,_.T,Z.N,R.h,L.aw,L.X$,I.rH],styles:[".assignees-list[_ngcontent-%COMP%]{max-height:100%;overflow:auto}.task-card[_ngcontent-%COMP%]{overflow:hidden}.task-card[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:1rem}.task-card[_ngcontent-%COMP%]   .start[_ngcontent-%COMP%]{max-width:23rem}.status[_ngcontent-%COMP%]{position:absolute;top:-1px;inset-inline-end:-1px}"]})}}return r})();function i(r,x){if(1&r&&(t.TgZ(0,"div",1)(1,"div",2)(2,"user-image",3),t.NdJ("click",function(c){return c.stopImmediatePropagation()}),t.qZA(),t.TgZ(3,"div",4)(4,"p",5),t._uU(5),t.qZA(),t.TgZ(6,"p",6),t._uU(7),t.qZA()()()()),2&r){const a=x.$implicit;t.xp6(2),t.Q6J("img",a.reporterProfilePicture)("id",a.reporterId),t.xp6(3),t.Oqu(a.reporterName),t.xp6(2),t.Oqu(a.reporterJobTitle)}}let d=(()=>{class r{constructor(){this.reporters=[]}static{this.\u0275fac=function(c){return new(c||r)}}static{this.\u0275cmp=t.Xpm({type:r,selectors:[["task-group-reporters"]],inputs:{reporters:"reporters"},standalone:!0,features:[t.jDz],decls:1,vars:1,consts:[["class","reporter-card relative rounded bg-gray p-1",4,"ngFor","ngForOf"],[1,"reporter-card","relative","rounded","bg-gray","p-1"],[1,"start","flex","aic"],[3,"img","id","click"],[1,"user-info","ml-1"],[1,"mb-25","fs-15"],[1,"muted","fs-14"]],template:function(c,u){1&c&&t.YNc(0,i,8,4,"div",0),2&c&&t.Q6J("ngForOf",u.reporters)},dependencies:[m.ez,m.sg,g.l],styles:[".reporter-card[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:1rem}"]})}}return r})();var p=n(98771),U=n(68671);function h(r,x){if(1&r){const a=t.EpF();t.TgZ(0,"button",13),t.NdJ("click",function(){t.CHM(a);const u=t.oxw();return t.KtG(u.chat())}),t._UZ(1,"img",14),t.qZA()}}function w(r,x){if(1&r&&t._UZ(0,"task-group-assignees",15),2&r){const a=t.oxw();t.Q6J("isDetails",a.isDetails)("isProject",a.isProject)("tasks",a.assignees)("taskGroupId",null==a.task?null:a.task.id)}}function $(r,x){1&r&&t._UZ(0,"loading")}function Y(r,x){if(1&r&&(t.ynx(0),t._UZ(1,"task-group-reporters",16),t.BQk()),2&r){const a=t.oxw();t.xp6(1),t.Q6J("reporters",a.reporters)}}function S(r,x){1&r&&(t.ynx(0),t._UZ(1,"not-found"),t.BQk())}const B=function(r){return{"h-100":r}};let K=(()=>{class r{ngOnChanges(a){a.task&&this.selected.setValue(0)}constructor(){this.open=!1,this.isDetails=!1,this.isProject=!1,this.reporters=[],this.assignees=[],this.isChat=!1,this.assigneesLoading=!1,this.close=new t.vpe,this.selected=new e.NI(0),this.taskDetailsSer=(0,t.f3M)(p.i),this.chatSer=(0,t.f3M)(U.a),this.router=(0,t.f3M)(I.F0)}ngOnInit(){}chat(){this.taskDetailsSer.getOrCreateChat(this.task.id).subscribe(a=>{this.chatSer.roomId.next(a.data.taskGroupChatId),this.chatSer.getRoomChat(!0),this.router.navigate(["/chat"])})}static{this.\u0275fac=function(c){return new(c||r)}}static{this.\u0275cmp=t.Xpm({type:r,selectors:[["task-group-details"]],inputs:{open:"open",task:"task",isDetails:"isDetails",isProject:"isProject",reporters:"reporters",assignees:"assignees",isChat:"isChat",assigneesLoading:"assigneesLoading"},outputs:{close:"close"},standalone:!0,features:[t.TTD,t.jDz],decls:18,vars:17,consts:[[3,"open"],["header",""],[1,"flex","aic","jcsb","w-100"],[1,"card-title"],["class","img clickable-btn chat ml-2",3,"click",4,"ngIf"],["content",""],["animationDuration","400ms",1,"h-100",3,"selectedIndex","selectedIndexChange"],[1,"h-100",3,"label"],[1,"overflow-hidden","h-100"],[3,"isDetails","isProject","tasks","taskGroupId",4,"ngIf"],[4,"ngIf"],[3,"label"],[1,"reporters","px-2","py-2",3,"ngClass"],[1,"img","clickable-btn","chat","ml-2",3,"click"],["src","assets/images/icons/messages.svg","alt","","width","24",1,"convert-image-color"],[3,"isDetails","isProject","tasks","taskGroupId"],[3,"reporters"]],template:function(c,u){1&c&&(t.TgZ(0,"info-sidebar",0),t.ynx(1,1),t.TgZ(2,"div",2)(3,"h3",3),t._uU(4),t.qZA(),t.YNc(5,h,2,0,"button",4),t.qZA(),t.BQk(),t.ynx(6,5),t.TgZ(7,"mat-tab-group",6),t.NdJ("selectedIndexChange",function(y){return u.selected.setValue(y)}),t.TgZ(8,"mat-tab",7),t.ALo(9,"translate"),t.TgZ(10,"div",8),t.YNc(11,w,1,4,"task-group-assignees",9),t.YNc(12,$,1,0,"loading",10),t.qZA()(),t.TgZ(13,"mat-tab",11),t.ALo(14,"translate"),t.TgZ(15,"div",12),t.YNc(16,Y,2,1,"ng-container",10),t.YNc(17,S,2,0,"ng-container",10),t.qZA()()(),t.BQk(),t.qZA()),2&c&&(t.Q6J("open",u.open),t.xp6(4),t.Oqu((null==u.task?null:u.task.title)||u.task),t.xp6(1),t.Q6J("ngIf",!u.isChat),t.xp6(2),t.Q6J("selectedIndex",u.selected.value),t.xp6(1),t.Q6J("label",t.lcZ(9,11,"assignees")),t.xp6(3),t.Q6J("ngIf",!u.assigneesLoading),t.xp6(1),t.Q6J("ngIf",u.assigneesLoading),t.xp6(1),t.Q6J("label",t.lcZ(14,13,"reporters")),t.xp6(2),t.Q6J("ngClass",t.VKq(15,B,u.reporters&&0==u.reporters.length)),t.xp6(1),t.Q6J("ngIf",u.reporters&&u.reporters.length>0),t.xp6(1),t.Q6J("ngIf",u.reporters&&0==u.reporters.length))},dependencies:[m.ez,m.mk,m.O5,C.K,l.Nh,l.uX,l.SP,O.N,T.w,G,d,L.aw,L.X$],styles:[".overflow-hidden[_ngcontent-%COMP%]{overflow:hidden}"]})}}return r})()},82424:(J,D,n)=>{n.d(D,{n:()=>g});var t=n(96814),m=n(89515),e=n(52081),C=n(88492),l=n(65879);function O(f,v){if(1&f&&(l.TgZ(0,"span",3),l._uU(1),l.ALo(2,"arabicNumbers"),l.qZA()),2&f){const _=l.oxw(2);l.xp6(1),l.Oqu(l.lcZ(2,1,_.endedTaskRepeatedCounter))}}function T(f,v){if(1&f&&(l.TgZ(0,"div")(1,"div"),l._UZ(2,"div",1),l.YNc(3,O,3,3,"span",2),l.TgZ(4,"span"),l._uU(5),l.ALo(6,"translate"),l.ALo(7,"defineDays"),l.qZA()()()),2&f){const _=l.oxw();l.xp6(1),l.Gre("flex-center ",_.classes,""),l.xp6(2),l.Q6J("ngIf","ar"==_.lang&&_.endedTaskRepeatedCounter>2||"en"==_.lang),l.xp6(2),l.Oqu(l.lcZ(6,5,l.lcZ(7,7,_.endedTaskRepeatedCounter)+"_day"))}}let g=(()=>{class f{constructor(){this.lang=localStorage.getItem("language")||"en"}static{this.\u0275fac=function(Z){return new(Z||f)}}static{this.\u0275cmp=l.Xpm({type:f,selectors:[["task-overdue"]],inputs:{endedTaskRepeatedCounter:"endedTaskRepeatedCounter",classes:"classes"},standalone:!0,features:[l.jDz],decls:1,vars:1,consts:[[4,"ngIf"],[1,"bullet","bg-danger","px-50","pt-50","pb-50","rounded-50","mr-75"],["class","mr-50",4,"ngIf"],[1,"mr-50"]],template:function(Z,R){1&Z&&l.YNc(0,T,8,9,"div",0),2&Z&&l.Q6J("ngIf",R.endedTaskRepeatedCounter>0)},dependencies:[t.ez,t.O5,m.aw,m.X$,e.m,C.K],encapsulation:2})}}return f})()},94279:(J,D,n)=>{n.d(D,{N:()=>O});var t=n(96814),m=n(52081),e=n(65879);const C=function(T,g){return{"bg-success":T,"bg-warning":g}},l=function(T,g){return{success:T,warning:g}};let O=(()=>{class T{constructor(){this.progress=0,this.width="10rem"}static{this.\u0275fac=function(v){return new(v||T)}}static{this.\u0275cmp=e.Xpm({type:T,selectors:[["task-vote-progress"]],inputs:{progress:"progress",width:"width",classes:"classes",color:"color"},standalone:!0,features:[e.jDz],decls:6,vars:18,consts:[[1,"task-progress","flex","aic"],[1,"bar","rounded","w-100","mr-1"],[1,"progress",3,"ngClass"],[3,"ngClass"]],template:function(v,_){1&v&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"div",2),e.qZA(),e.TgZ(3,"span",3),e._uU(4),e.ALo(5,"arabicNumbers"),e.qZA()()),2&v&&(e.Udp("width",_.width),e.xp6(2),e.Udp("width",_.progress+"%"),e.Q6J("ngClass",e.WLB(12,C,100==_.progress,100!=_.progress)),e.xp6(1),e.Gre("fs-14 ",_.color,""),e.Q6J("ngClass",e.WLB(15,l,100==_.progress&&!_.color,100!=_.progress&&!_.color)),e.xp6(1),e.hij("",e.lcZ(5,10,_.progress),"%"))},dependencies:[t.ez,t.mk,m.m],styles:['.task-progress[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{position:relative;height:4px;background-color:#e2e2e2;overflow:hidden}.task-progress[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]{content:"";position:absolute;top:0;left:0;height:100%}']})}}return T})()},81540:(J,D,n)=>{function t(m){return m.replace(/(https?:\/\/[^\s]+)/g,function(C){return`<a target="_blank" href="${C}" class="primary">${C}</a>`})}n.d(D,{w:()=>t})},98771:(J,D,n)=>{n.d(D,{i:()=>L});var t=n(65879),m=n(65619),e=n(94664),C=n(9315),l=n(21631),O=n(22096),T=n(37398),g=n(20553),f=n(24708),v=n(81540),_=n(32221),Z=n(68671),R=n(69862);let L=(()=>{class I extends _.W{constructor(o){super(),this.http=o,this.chatSer=(0,t.f3M)(Z.a),this.hasChanged=new m.X(!1),this.loading=new m.X(!0),this.id=new m.X(0),this.chatLoading=new m.X(!0),this.gotChat=new m.X(!1),this.details=new m.X({})}getTaskDetails(){return this.loading.next(!0),this.chatLoading.next(!0),this.http.get(`${g.N.apiUrl}api/Tasks/GetTaskDetails?id=${this.id.value}`).pipe((0,e.w)(o=>{const s=o.data,P=parseInt(localStorage.getItem("id")||"");return s.hasStarted=(0,f.u)(s.startDate).getTime()<(new Date).getTime(),s.creator=s.taskGroupCreatorId==P,s.isAssignee=s.assigneeId==P,s.isManager=s.managerId==P,s.canUpdateRate=new Date((0,f.u)(s.rateDate).setMinutes((0,f.u)(s.rateDate).getMinutes()+10)).getTime()>=(new Date).getTime(),5==s.taskGroupType?navigator.geolocation&&navigator.geolocation.getCurrentPosition(k=>{if(k){let A=new google.maps.LatLng(k.coords.latitude,k.coords.longitude),N=new google.maps.LatLng(s.latitude,s.longitude);const M=google.maps.geometry.spherical.computeDistanceBetween(A,N);s.inLocation=M<=100}}):s.inLocation=!0,(0,f.u)(s.endTimeForRepeat).getTime()<(new Date).getTime()&&(s.stopedRepeat=!0),s.max=s.isAssignee?100:s.creator?99:100,s.taskGroupAttachments=s.taskGroupAttachments.filter(k=>(5===k.fileType&&(s.soundDescription=`${g.N.apiUrl}/${k.filePath}`),5!==k.fileType)),s.description&&(s.description=(0,v.w)(s.description)),s.definitionOfDone&&(s.definitionOfDone=(0,v.w)(s.definitionOfDone)),s.workingHours={},this.workingHours(s.workingHours,s.expectedTime,s.actualTime),(0,C.D)([this.getReporters(s.taskGroupId),this.getSubTasks(s.taskGroupId),this.getTaskHistory(s.taskId),this.getTaskLog(s.taskId)]).pipe((0,l.z)(([k,A,N,M])=>{s.reporters=k;let b=N,G=M;if(s.reportersImagesUrls=k.map((i,d)=>(s.reporters[d].image=i.reporterProfilePicture,s.reporters[d].name=i.reporterName,s.reporters[d].jobTitle=i.reporterJobTitle,i.reporterProfilePicture)),s.subTasks=A,b.success){const d=b.data.reduce((p,U)=>{const h=new Date(new Date(U.creationDate).setHours(0,0,0,0)).getTime();return p[h]||(p[h]=[]),p[h].push(U),p},{});s.histories=Object.keys(d).map(p=>({date:new Date(+p),messages:d[p]}))}if(G.success){const d=G.data.reduce((p,U)=>{const h=new Date(new Date(U.creationDate).setHours(0,0,0,0)).getTime();return p[h]||(p[h]=[]),p[h].push(U),p},{});s.timeLogHistory=Object.keys(d).map(p=>({date:new Date(+p),messages:d[p]}))}return this.loading.next(!1),!s.creator&&!s.isAssignee||1!=s.taskStateId&&2!=s.taskStateId&&3!=s.taskStateId||this.gotChat.value?this.chatLoading.next(!1):this.getOrCreateChat(s.taskGroupId).subscribe(i=>{console.log(i),i&&(setTimeout(()=>{this.chatLoading.next(!1),this.gotChat.next(!0)},1e3),this.chatSer.roomId.next(i.data.taskGroupChatId),this.chatSer.getRoomChat(!0))}),this.details.next(s),(0,O.of)(s)}))}))}getReporters(o){return this.http.get(`${g.N.apiUrl}api/TaskGroupReporters/GetReporters?id=${o}`).pipe((0,T.U)(s=>s.data.items))}getTaskHistory(o){return this.http.get(`${g.N.apiUrl}api/TaskHistory/Get?taskId=${o}`)}getTaskLog(o){return this.http.get(`${g.N.apiUrl}api/TimeSheet/GetTaskLogs?TaskId=${o}`).pipe((0,T.U)(s=>s.data))}getSubTasks(o){return this.http.get(`${g.N.apiUrl}api/TaskGroups/GetMyChildTaskGroups?parentTaskGroupId=${o}`).pipe((0,T.U)(s=>s.data.items))}updateTodoList(o){return this.http.put(`${g.N.apiUrl}api/TaskTodosList/Update`,o)}stopRepeat(o){return this.http.put(`${g.N.apiUrl}api/TaskGroups/StopRepeat`,o)}updateEstimate(o){return this.http.put(`${g.N.apiUrl}api/Tasks/UpdateEstimatedTime`,o)}noted(o){return this.http.put(`${g.N.apiUrl}api/Tasks/SetSignatureTaskNoticed`,{id:o})}updateTaskProgress(o){return this.http.put(`${g.N.apiUrl}api/Tasks/UpdateProgress`,o)}addRate(o){return this.http.put(`${g.N.apiUrl}api/Tasks/UpdateRate`,o)}getTaskGroupUserRole(o){return this.http.get(`${g.N.apiUrl}api/TaskGroups/GetTaskGroupUserRole?id=${o}`).pipe((0,T.U)(s=>({userRole:s.data.taskUserRole,taskId:s.data.taskId,taskGroupId:s.data.taskGroupId})))}getOrCreateChat(o){return this.http.post(`${g.N.apiUrl}api/Chat/AddTaskChatRoom`,{id:o})}logTime(o){return this.http.post(`${g.N.apiUrl}api/TimeSheet/LogTime`,o)}cancelTask(o){return this.http.put(`${g.N.apiUrl}api/Tasks/Cancel`,{taskIds:[o]})}deleteTask(o){return this.http.put(`${g.N.apiUrl}api/Tasks/delete`,o)}getDetails(o){return this.http.get(`${g.N.apiUrl}api/Tasks/GetTaskDetails?id=${o}`)}getProps(o){return this.http.post(`${g.N.apiUrl}api/TaskGroups/GetTaskProps?taskId=${o}`,"")}answerProps(o){return this.http.post(`${g.N.apiUrl}api/TaskGroups/AnswerProp`,"",{params:o})}uploadPropFile(o){return this.http.post(`${g.N.apiUrl}api/attachment/UploadFile`,o)}static{this.\u0275fac=function(s){return new(s||I)(t.LFG(R.eN))}}static{this.\u0275prov=t.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"})}}return I})()}}]);