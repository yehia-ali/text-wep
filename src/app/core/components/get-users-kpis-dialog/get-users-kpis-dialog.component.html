<div class="dir py-2">
  <div class="flex aic jcsb px-2 mb-2">
    <p class="fs-18 black simibold">{{'link_kpi_to_task' | translate}}</p>
    <i class="bx bx-x fs-20 pointer" (click)="dialogRef.close()"></i>
  </div>
  <div class="" *ngIf="!loading && itemsList.length > 0">
    <div class="table-container border-0 px-2">
      <table class="table table-bordered ">
        <thead>
          <tr class="bg-gray">
            <th class="text-left kpis-1-col-width">{{'employee'}}</th>
            <th class="text-left kpis-2-col-width text-left">{{'kpi_category' | translate}}</th>
            <th class="text-left kpis-3-col-width">{{'kpi' | translate}}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of itemsList" class="border-bottom">
            <!-- معلومات المستخدم -->
            <td class="text-left">
              <app-img-title
                [title]="item.userName"
                [subTitle]="item.userJobTitle"
                [userId]="item.userId"
                [imgSrc]="item.userPic"
              />
            </td>

            <!-- اختيار الفئة (Category) -->
            <td class="text-left">
              <span *ngIf="item.kpiCategories.length == 0">{{'assign_kpi_categeory_first' | translate}}</span>
              <ng-select
                *ngIf="item.kpiCategories.length > 0"
                [items]="item.kpiCategories"
                bindLabel="categoryName"
                bindValue="employeeCategoryId"
                class="icon-input"
                [multiple]="false"
                [(ngModel)]="item.selectedCategory"
                (change)="onCategoryChange($event, item)"
                [compareWith]="compareCategories"
              ></ng-select>
            </td>

            <!-- اختيار KPI -->
            <td class="text-left">
              <span *ngIf="item.selectedCategory?.kpis.length == 0">{{'assign_kpi_categeory_first' | translate}}</span>

              <ng-select
              *ngIf="item.selectedCategory?.kpis.length > 0"
                [items]="item.selectedCategory?.kpis || []"
                bindLabel="kpiName"
                bindValue="employeeKpiId"
                class="icon-input"
                [multiple]="false"
                [(ngModel)]="item.selectedKpi"
                [compareWith]="compareKpis"
              ></ng-select>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="text-right mt-2 px-2">
      <button class="btn bg-primary rounded py-75 px-1 white" (click)="submit()">{{'save' | translate}}</button>
    </div>
  </div>
  <div class="flex aic jcc py-5" *ngIf="loading || itemsList.length == 0">
    <loading *ngIf="loading" [centerd]="true"/>
    <not-found *ngIf="!loading && itemsList.length == 0" />
  </div>
</div>
